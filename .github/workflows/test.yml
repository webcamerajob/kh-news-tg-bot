name: WireGuard VPN Workflow

on:
  workflow_dispatch:

jobs:
  use-wireguard:
    runs-on: ubuntu-latest

    steps:
    - name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
      run: |
        curl --connect-timeout 5 https://www.google.com || {
          echo "–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞."
          exit 1
        }

    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
      run: |
        sudo apt-get update
        sudo apt-get install -y wireguard-tools

    - name: üìÅ –°–±–æ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ WireGuard –∫–æ–Ω—Ñ–∏–≥–∞
      run: |
        mkdir -p $HOME/wg
        echo "${{ secrets.WG_CONFIG }}" > $HOME/wg/wg0.conf
        chmod 600 $HOME/wg/wg0.conf

    - name: üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VPN –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DNS
      run: |
        sudo wg-quick up $HOME/wg/wg0.conf
        echo "nameserver 1.1.1.1" | sudo tee /etc/resolv.conf > /dev/null
        echo "–ü—É–±–ª–∏—á–Ω—ã–π IP –ø–æ–¥ VPN:"
        curl -s https://ipinfo.io/ip

    - name: ‚öôÔ∏è –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π —á–µ—Ä–µ–∑ VPN
      run: |
        echo "–î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:"
         curl -X POST https://www.khmertimeskh.com/wp-json/wp/v2/categories?slug=national --data '...'
        # python3 bot.py --proxy-vpn-mode

    - name: üõë –û—Ç–∫–ª—é—á–µ–Ω–∏–µ VPN
      if: always()
      run: |
        sudo wg-quick down $HOME/wg/wg0.conf || echo "WireGuard —É–∂–µ –±—ã–ª –∑–∞–≤–µ—Ä—à—ë–Ω"
