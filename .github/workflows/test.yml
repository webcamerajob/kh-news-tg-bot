name: WireGuard with CF Bypass

on:
  workflow_dispatch:

jobs:
  bypass-vpn:
    runs-on: ubuntu-latest

    steps:
    - name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
      run: |
        curl --connect-timeout 5 https://www.google.com || {
          echo "–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞."
          exit 1
        }

    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
      run: |
        sudo apt-get update
        sudo apt-get install -y wireguard-tools

    - name: üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WireGuard
      run: |
        mkdir -p $HOME/wg
        echo "${{ secrets.WG_CONFIG }}" > $HOME/wg/wg0.conf
        chmod 600 $HOME/wg/wg0.conf

    - name: üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VPN –∏ DNS —Ñ–∏–∫—Å–∞—Ü–∏—è
      run: |
        sudo wg-quick up $HOME/wg/wg0.conf
        echo "nameserver 1.1.1.1" | sudo tee /etc/resolv.conf > /dev/null
        echo "VPN –∞–∫—Ç–∏–≤–µ–Ω. IP:"
        curl -s https://ipinfo.io/ip

    - name: üõ°Ô∏è Cloudflare Bypass Curl
      run: |
        echo "‚ö†Ô∏è CF Bypass curl —Å User-Agent –∏ IP fallback:"
        
        curl -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
          -H "Referer: https://www.google.com/" \
          --connect-timeout 10 \
          -L https://your-cloudflare-domain.com || echo "WAF –≤—Å—ë –µ—â—ë –±–ª–æ–∫–∏—Ä—É–µ—Ç üòë"

    - name: ‚öôÔ∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ –ø–æ IP
      run: |
        echo "üí° –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –ø–æ IP, –±–µ–∑ DNS:"
        curl http://X.X.X.X || echo "–ù–µ —É–¥–∞–ª–æ—Å—å ‚Äî IP –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω"

    - name: üõë –û—Ç–∫–ª—é—á–µ–Ω–∏–µ VPN
      if: always()
      run: |
        sudo wg-quick down $HOME/wg/wg0.conf || echo "WireGuard —É–∂–µ –±—ã–ª –∑–∞–≤–µ—Ä—à—ë–Ω"
