name: WireGuard VPN Job

on:
  workflow_dispatch:

jobs:
  wireguard-vpn:
    runs-on: ubuntu-latest

    steps:
    - name: Проверка интернета
      run: |
        curl --connect-timeout 5 https://www.google.com || {
          echo "Нет интернета"
          exit 1
        }

    - name: Установка WireGuard
      run: |
        sudo apt-get update
        sudo apt-get install -y wireguard-tools

    - name: Создание локального конфига
      run: |
        mkdir -p $HOME/wg
        echo "${{ secrets.WG_CONFIG }}" > $HOME/wg/wg0.conf
        chmod 600 $HOME/wg/wg0.conf

    - name: Подключение VPN напрямую по пути
      run: |
        sudo wg-quick up $HOME/wg/wg0.conf
        echo "IP под VPN:"
        curl https://ipinfo.io/ip

    - name: Действия под VPN
      run: |
        echo "Тут ваши команды — бот, API, скрипты"

    - name: Отключение VPN
      if: always()
      run: |
        sudo wg-quick down $HOME/wg/wg0.conf || echo "VPN уже завершён"
