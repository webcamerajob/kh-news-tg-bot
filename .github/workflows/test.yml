name: WireGuard VPN Quick Job

on:
  workflow_dispatch:

jobs:
  wg-vpn:
    runs-on: ubuntu-latest

    steps:
    - name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
      run: |
        curl -s --connect-timeout 5 https://google.com || {
          echo "–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"
          exit 1
        }

    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
      run: |
        sudo apt-get update
        sudo apt-get install -y wireguard-tools resolvconf nftables

    - name: üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN
      run: |
        mkdir -p $HOME/wg
        echo "${{ secrets.WG_CONFIG }}" > $HOME/wg/wg0.conf
        chmod 600 $HOME/wg/wg0.conf

    - name: üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VPN + DNS Fix
      run: |
        sudo wg-quick up $HOME/wg/wg0.conf
        echo "nameserver 1.1.1.1" | sudo tee /etc/resolv.conf
        echo "IP –ø–æ–¥ VPN:"
        curl -s -A "Mozilla/5.0" https://ipinfo.io/ip || echo "Cloudflare –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"

    - name: ‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è –ø–æ–¥ VPN
      run: |
        echo "üöÄ –°—é–¥–∞ –≤—Å—Ç–∞–≤—å –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:"
        curl -A "Mozilla/5.0" -L https://—Ç–≤–æ—è-—Ü–µ–ª—å.com/api

    - name: üõë –û—Ç–∫–ª—é—á–µ–Ω–∏–µ VPN
      if: always()
      run: |
        sudo wg-quick down $HOME/wg/wg0.conf || echo "WireGuard —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω"
