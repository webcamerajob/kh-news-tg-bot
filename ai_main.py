import os
import sys
import json
import logging
import requests
import main  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–≤–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç

# --- –ù–ê–°–¢–†–û–ô–ö–ò OPENROUTER ---
# –£–∫–∞–∂–∏ —Å–≤–æ–π –∫–ª—é—á –∑–¥–µ—Å—å –∏–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
OPENROUTER_API_KEY = os.getenv("OPENROUTER_API_KEY", "YOUR_API_KEY_HERE")
MODEL = "google/gemini-2.0-flash-lite-001:free"

def translate_with_ai(text: str, to_lang: str = "ru", provider: str = "ai") -> str:
    """
    –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ —á–µ—Ä–µ–∑ –ò–ò, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é.
    –û–Ω–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç, –Ω–æ –∏ —á–∏—Å—Ç–∏—Ç —Ç–µ–∫—Å—Ç –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
    """
    if not text.strip():
        return ""

    logging.info(f"ü§ñ [AI] –ü–µ—Ä–µ–≤–æ–¥ –∏ –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç—å–∏ —á–µ—Ä–µ–∑ {MODEL}...")

    prompt = (
        f"–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–æ–≤–æ—Å—Ç–Ω–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä. –ü–µ—Ä–µ–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —è–∑—ã–∫ '{to_lang}'.\n"
        "–°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê:\n"
        "1. –£–î–ê–õ–ò –≤—Å–µ –±–ª–æ–∫–∏ 'Related Articles', 'Read also', —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ –Ω–æ–≤–æ—Å—Ç–∏.\n"
        "2. –£–î–ê–õ–ò –ø—Ä–∏–∑—ã–≤—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ—Ü—Å–µ—Ç–∏ (Follow us on...).\n"
        "3. –£–î–ê–õ–ò —Ä–µ–∫–ª–∞–º–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏, –±–∞–Ω–Ω–µ—Ä—ã –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã.\n"
        "4. –û–°–¢–ê–í–¨ —Ç–æ–ª—å–∫–æ —Å—É—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫.\n"
        "5. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –æ—Ç —Å–µ–±—è.\n\n"
        f"–¢–ï–ö–°–¢ –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò:\n{text}"
    )

    try:
        response = requests.post(
            url="https://openrouter.ai/api/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {OPENROUTER_API_KEY}",
                "Content-Type": "application/json",
            },
            data=json.dumps({
                "model": MODEL,
                "messages": [{"role": "user", "content": prompt}]
            }),
            timeout=60
        )
        response.raise_for_status()
        result = response.json()
        translated_text = result['choices'][0]['message']['content']
        return translated_text.strip()
    
    except Exception as e:
        logging.error(f"‚ùå [AI ERROR] –û—à–∏–±–∫–∞ OpenRouter: {e}. –û—Ç–∫–∞—Ç –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—É.")
        return text # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª

# --- –ú–û–ù–ö–ï–ô-–ü–ê–¢–ß–ò–ù–ì ---
# –ü–æ–¥–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤ –º–æ–¥—É–ª–µ main –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç—É
main.translate_text = translate_with_ai

if __name__ == "__main__":
    # –ó–∞–ø—É—Å–∫–∞–µ–º main() –∏–∑ —Ç–≤–æ–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    # –í—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (--base-url –∏ —Ç.–¥.) –ø–æ–¥—Ö–≤–∞—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    main.main()
